CREATE TABLE USUARIO
( PNOME 		VARCHAR(16)		 NOT NULL,
  SNOME			VARCHAR(16)		 NOT NULL,
  CPF			INT			 NOT NULL,
  EMAIL			VARCHAR(55)		 NOT NULL,
  NUMEROCC		INT			 NOT NULL,
CONSTRAINT PKUSUARIO
           PRIMARY KEY (CPF,NUMEROCC),
CONSTRAINT FKUSUARIO
           FOREIGN KEY (NUMEROCC) REFERENCES CCREDITO(NUMERO)
           ON UPDATE CASCADE ON DELETE RESTRICT);




CREATE TABLE MOTORISTA
( CNH 			INT			 NOT NULL,
  CPF			INT			 NOT NULL,
  PNAME			VARCHAR(16)		 NOT NULL,
  SNAME			VARCHAR(16)		 NOT NULL,
  CONTACORRENTE	        INT			 NOT NULL,
  MEDIAAVALIACAO	DECIMAL(1,1),
CONSTRAINT PKMOTORISTA
           PRIMARY KEY (CNH),
UNIQUE(CPF),
UNIQUE(CONTACORRENTE));


CREATE TABLE GRUPO
( ID	 		INT			 NOT NULL,
  NOME			VARCHAR(31)		 NOT NULL,
  NPESSOAS		SMALLINT		 NOT NULL,
CONSTRAINT PKGRUPO
           PRIMARY KEY (ID));


CREATE TABLE MEMBROS
(  CPF				INTEGER			 NOT NULL ,
    ID				INTEGER			 NOT NULL,
    NCARTAO                      INTEGER,
    CNH				INTEGER,
CONSTRAINT PKMEMBROS
	    PRIMARY KEY (CPF, ID),
CONSTRAINT FK1MEMBROS
            FOREIGN KEY (CPF) REFERENCES USUARIO(CPF)
            ON UPDATE RESTRICT ON DELETE RESTRICT,
CONSTRAINT FK2MEMBROS
            FOREIGN KEY (ID) REFERENCES GRUPO(ID)
            ON UPDATE CASCADE ON DELETE RESTRICT,
CONSTRAINT FK3MEMBROS
            FOREIGN KEY (NCARTAO) REFERENCES CCREDITO(NUMERO)
            ON UPDATE CASCADE ON DELETE RESTRICT,
CONSTRAINT FK4MEMBROS
           FOREIGN KEY (CNH) REFERENCES MOTORISTA(CNH)
           ON UPDATE RESTRICT ON DELETE RESTRICT);




CREATE TABLE CORRIDA
(  DATA				DATE			 NOT NULL,
    HORA			TIME			 NOT NULL,
    CPF				INT      		 NOT NULL,
    NCARTAO			INT			 NOT NULL,
    RENAVAM			INT			 NOT NULL,
    CNH				INT			 NOT NULL,
    ORIGEM			VARCHAR(55)		 NOT NULL,
    DESTINO			VARCHAR(55)		 NOT NULL,
    CONCRETIZADO		CHAR(3),
    AVALIACAO			SMALLINT,
    COMENTARIO			VARCHAR(55),
    VALOR		        DECIMAL(3,2),
CONSTRAINT PKCORRIDA
           PRIMARY KEY (DATA, HORA, CPF),
CONSTRAINT FK1CORRIDA
           FOREIGN KEY (CPF) REFERENCES USUARIO(CPF)
           ON UPDATE RESTRICT ON DELETE RESTRICT,
CONSTRAINT FK2CORRIDA
           FOREIGN KEY (NCARTAO) REFERENCES CCREDITO(NUMERO)
           ON UPDATE CASCADE ON DELETE RESTRICT,
CONSTRAINT FK3CORRIDA
           FOREIGN KEY (RENAVAM) REFERENCES CARRO (RENAVAM)
           ON UPDATE RESTRICT ON DELETE RESTRICT,
CONSTRAINT FK4CORRIDA
           FOREIGN KEY (CNH) REFERENCES MOTORISTA (CNH)
           ON UPDATE RESTRICT ON DELETE CASCADE);

CREATE TABLE GRUPOCORRIDA
(   DATA			DATE			 NOT NULL,
    HORA			TIME			 NOT NULL,
    ID				INT	 		 NOT NULL,
    RENAVAM			INT			 NOT NULL,
    CNH				INT			 NOT NULL,
    ORIGEM			VARCHAR(55)		 NOT NULL,
    DESTINO			VARCHAR(55)	 	 NOT NULL,
    CONCRETIZADO		CHAR(3),
    AVALIACAO			SMALLINT,
    COMENTARIO			VARCHAR(55),
    VALOR			DECIMAL(3,2),
CONSTRAINT PKGRUPOCORRIDA
           PRIMARY KEY (DATA, HORA, ID),
CONSTRAINT FK1GRUPOCORRIDA
           FOREIGN KEY (ID) REFERENCES GRUPO(ID)
           ON UPDATE RESTRICT ON DELETE RESTRICT,
CONSTRAINT FK2GRUPOCORRIDA
           FOREIGN KEY (RENAVAM) REFERENCES CARRO (RENAVAM)
            ON UPDATE RESTRICT ON DELETE RESTRICT,
CONSTRAINT FK3GRUPOCORRIDA
           FOREIGN KEY (CNH) REFERENCES MOTORISTA (CNH)
           ON UPDATE RESTRICT ON DELETE RESTRICT);




CREATE TABLE CCREDITO
( NUMERO	 		INT			 NOT NULL ,
  VALIDADE			DATE			NOT NULL ,
  CODSEG			INT			 NOT NULL,
  TITULAR			VARCHAR(55)		 NOT NULL,
CONSTRAINT PKCCREDITO
           PRIMARY KEY (NUMERO));


CREATE TABLE MOTORISTACARRO
( CNH		 		INTEGER			 NOT NULL ,
  RENAVAM			INTEGER			 NOT NULL ,
CONSTRAINT PKMOTORISTACARRO
             PRIMARY KEY (CNH),
UNIQUE(RENAVAM),
CONSTRAINT FK1MOTORISTACARRO
             FOREIGN KEY (CNH) REFERENCES MOTORISTA (CNH)
             ON UPDATE RESTRICT ON DELETE RESTRICT,
CONSTRAINT FK2MOTORISTACARRO
             FOREIGN KEY (RENAVAM) REFERENCES CARRO (RENAVAM)
             ON UPDATE RESTRICT ON DELETE RESTRICT);




CREATE TABLE CARRO
(RENAVAM		INTEGER			 NOT NULL,
 PLACA			CHAR(7)			 NOT NULL,
 MODELO			VARCHAR(16)		 NOT NULL,
 COR			VARCHAR(11)		 NOT NULL,
 TIPOCATEGORIA		VARCHAR(16)		 NOT NULL,
 VAGAS			SMALLINT		 NOT NULL,
CONSTRAINT PKCARRO
            PRIMARY KEY (RENAVAM),
UNIQUE(PLACA),
CONSTRAINT FKCARRO
            FOREIGN KEY (TIPOCATEGORIA) REFERENCES CATEGORIA(TIPO)
            ON UPDATE CASCADE ON DELETE RESTRICT);


CREATE TABLE CATEGORIA
( TIPO		 		VARCHAR(16)		 NOT NULL,
  TARIFA			DECIMAL(3,2)		 NOT NULL,
CONSTRAINT PKCATEGORIA
	PRIMARY KEY (TIPO));



CREATE TABLE MENSAGEM
( DATA	 		DATE				 NOT NULL ,
  HORA			TIME				 NOT NULL ,
  CPF			INT				 NOT NULL,
  ID 			INT				 NOT NULL,
  CONTEUDO  		VARCHAR(140)			 NOT NULL,
CONSTRAINT PKMENSAGEM
             PRIMARY KEY (DATA, HORA, CPF),
CONSTRAINT FK1MESSAGEM
             FOREIGN KEY (CPF) REFERENCES USUARIO (CPF)
             ON UPDATE RESTRICT ON DELETE RESTRICT,
CONSTRAINT FK2MESSAGEM
             FOREIGN KEY (ID) REFERENCES GRUPO (ID)
             ON UPDATE RESTRICT ON DELETE RESTRICT);






CREATE TABLE MENSAGEMMOTORISTA
( DATA	 		DATE				 NOT NULL,
  HORA			TIME				 NOT NULL,
  CNH			INTEGER				 NOT NULL,
  CPF 			INTEGER				 NOT NULL,
  CONTEUDO  		VARCHAR(140)			 NOT NULL,
CONSTRAINT PKMENSAGEMMOTORISTA
            PRIMARY KEY (DATA, HORA, CNH),
CONSTRAINT FK1MENSAGEMMOTORISTA
            FOREIGN KEY (CPF) REFERENCES USUARIO (CPF)
            ON UPDATE RESTRICT ON DELETE RESTRICT,
CONSTRAINT FK2MENSAGEMMOTORISTA
            FOREIGN KEY (CNH) REFERENCES MOTORISTA (CNH)
            ON UPDATE RESTRICT ON DELETE RESTRICT);


CREATE TABLE AGENDA
( IDAGENDA		INT				 NOT NULL,
  DATA	 		DATE				 NOT NULL,
  HORA			TIME				 NOT NULL,
  ORIGEM		VARCHAR(55)			 NOT NULL,
  DESTINO		VARCHAR(55)			 NOT NULL,
  CATEGORIA		VARCHAR(16)		         NOT NULL,
CONSTRAINT PKAGENDA
             PRIMARY KEY (IDAGENDA),
CONSTRAINT FKAGENDA
             FOREIGN KEY (CATEGORIA) REFERENCES CATEGORIA(TIPO)
             ON UPDATE CASCADE ON DELETE RESTRICT);


CREATE TABLE AGENDAUSUARIO
( IDAGENDA			INT			 NOT NULL,
  CPF				INT			 NOT NULL,
  CNH				INT			 NOT NULL,
CONSTRAINT PKAGENDAUSUARIO
             PRIMARY KEY (IDAGENDA, CPF),
CONSTRAINT FK1AGENDAUSUARIO
             FOREIGN KEY (IDAGENDA) REFERENCES AGENDA (IDAGENDA)
             ON UPDATE CASCADE ON DELETE RESTRICT,
CONSTRAINT FK2AGENDAUSUARIO
             FOREIGN KEY (CPF) REFERENCES USUARIO (CPF)
             ON UPDATE RESTRICT ON DELETE RESTRICT,
CONSTRAINT FK3AGENDAUSUARIO
             FOREIGN KEY (CNH) REFERENCES MOTORISTA(CNH)
             ON UPDATE RESTRICT ON DELETE RESTRICT);


CREATE TABLE AGENDGRUPO
( IDAGENDA			INT			 NOT NULL,
  IDGRUPO			INT			 NOT NULL,
  CNH				INT			 NOT NULL,
CONSTRAINT PKAGENDAGRUPO
             PRIMARY KEY (IDAGENDA, IDGRUPO),
CONSTRAINT FK1AGENDAGRUPO
             FOREIGN KEY (IDAGENDA) REFERENCES AGENDA (IDAGENDA)
             ON UPDATE CASCADE ON DELETE RESTRICT,
CONSTRAINT FK2AGENDAGRUPO
             FOREIGN KEY (IDGRUPO) REFERENCES GRUPO (ID)
             ON UPDATE CASCADE ON DELETE RESTRICT,
CONSTRAINT FK3AGENDAGRUPO
             FOREIGN KEY (CNH) REFERENCES MOTORISTA(CNH)
            ON UPDATE RESTRICT ON DELETE RESTRICT);










CREATE TABLE AGENDAMOTORISTA
( IDAGENDA			INT			 NOT NULL,
  CNH				INT			 NOT NULL,
  CPF				INT,
  ID				INT,
CONSTRAINT PKAGENDAMOTORISTA
            PRIMARY KEY (IDAGENDA, CNH),
CONSTRAINT FK1AGENDAMOTORISTA
            FOREIGN KEY (IDAGENDA) REFERENCES AGENDA (IDAGENDA)
            ON UPDATE CASCADE ON DELETE RESTRICT,
CONSTRAINT FK2AGENDAMOTORISTA
            FOREIGN KEY (CNH) REFERENCES MOTORISTA (CNH)
            ON UPDATE RESTRICT ON DELETE RESTRICT,
CONSTRAINT FK3AGENDAMOTORISTA
            FOREIGN KEY (CPF) REFERENCES USUARIO (CPF)
            ON UPDATE SET NULL ON DELETE CASCADE,
CONSTRAINT FK4AGENDAMOTORISTA
            FOREIGN KEY (ID) REFERENCES GRUPO(ID)
            ON UPDATE SET NULL ON DELETE CASCADE);
